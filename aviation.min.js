/* Aviation - URL routing inspired by express for the frontend! | v1.2.0 | Written by Dev Ang | MIT License */
if("undefined"==typeof $)throw new Error("Aviation requires jQuery for now.");function Aviation(e){if(!(this instanceof Aviation))return new Aviation(e);"object"!=typeof e&&(e={strict:!1,caseSensitive:!1});var t=[],n=this,o=$(e.contentWrapper||"body"),r=e.onError||console.error;this.use=function(o,r){var i=o,a=r,c=[];if(r||(a=o,i=/^.*$/),!(i instanceof RegExp)){if(i.constructor==Array||i.constructor==Object){for(var s in i)n.use(i[s],r);return n}i=String(i);var p="";i=$("<a href='"+i+"'></a>").get(0).pathname,e.strict||(i=i.replace(/\/$/,"")),e.caseSensitive||(p="i"),e.removeFromPath&&(i=i.replace(e.removeFromPath,"")),/\:/.test(i)?(i=i.replace(/\*+/g,"").replace(/:([^\/]+)/g,function(e,t){return c.push(t),"([^\\/]+?)"}),i=new RegExp("^"+i.split("([^\\/]+?)").map(function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join("([^\\/]+?)")+"$",p)):i=new RegExp("^"+i.split(/\*+/).map(function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join(".*")+"$",p)}return t.push({path:i,keys:c,fn:a}),n},this.on=this.use,this.handle=function(c){var s="string"==typeof c?c:"object"!=typeof c?"/":c.href?c.href:this.href?this.href:this.action?this.action:"/",p=$("<a href="+s+"></a>").get(0),u=p.pathname;e.strict||(u=u.replace(/\/$/,"")),e.removeFromPath&&(u=u.replace(e.removeFromPath,""));var h=[];for(var f in t){var l=t[f];if(l.path.test(u)){var m={},d=u.match(l.path).slice(1);if(l.keys.length)for(var f in d)m[l.keys[f]]=d[f];h.push({fn:l.fn,params:m})}}if(!h.length)return n;c.preventDefault&&c.preventDefault();var v={url:p.href,hostname:p.hostname,pathname:u,protocol:p.protocol?p.protocol.replace(":",""):null,secure:!1,query:i(p.href),params:{},cookies:a(),aviation:n};"https"==v.protocol&&(v.secure=!0);var g={cookie:function(e,t,n){return n||(n={}),v.cookies[e]=t,void 0===n.maxAge&&void 0===n.expires&&(n.maxAge=2628e3),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(n.maxAge?";max-age="+encodeURIComponent(n.maxAge):"")+(n.expires?";expires="+encodeURIComponent(n.expires):"")+(n.path?";path="+encodeURIComponent(n.path):";path")+(n.domain?";domain="+encodeURIComponent(n.domain):"")+(n.secure?";secure="+encodeURIComponent(n.secure):"")+(n.sameSite?";samesite="+encodeURIComponent(n.sameSite):""),this},clearCookie:function(e,t){return t.maxAge=-1,this.cookie(e,null,t),delete v.cookies[e],this},location:function(e){var t=!0;return n.handle({href:e,preventDefault:function(){t=!1}}),t&&(window.location=e),this},redirect:function(e){return this.location(e)},page:function(e,t){return"undefined"!=typeof history&&history.pushState&&history.pushState({},e,t||v.url),$("title").text(e),this},html:function(e){return o.html(e),this}},y=function(e){try{if(e)throw e;var t=h[++f];if(!t)return;v.params=t.params,t.fn(v,g,y)}catch(e){r(e)}};f=-1;return y(),n},$(document).ready(function(){n.handle(window.location)}),$(document).on(e.event||"click",e.source||"a:not([target='_blank'])",n.handle),window.addEventListener("popstate",function(e){n.handle(window.location.href)},!1);var i=function(e){if(!/\?/.test(e))return{};var t={},n=e.split("?")[1].split("&");for(var o in n){var r=n[o].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t},a=function(){var e={},t=document.cookie.split(";");for(var n in t){var o=t[n].split("=");o[0]&&o[1]&&(e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]))}return e}}
