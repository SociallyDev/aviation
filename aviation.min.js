/* Aviation - URL routing inspired by express for the frontend! | v1.1.0 | Written by Dev Ang | MIT License */
if("undefined"==typeof $)throw new Error("Aviation requires jQuery for now.");function Aviation(e){if(!(this instanceof Aviation))return new Aviation(e);"object"!=typeof e&&(e={strict:!1,caseSensitive:!1});var t=[],o=this,n=$(e.contentWrapper||"body"),r=e.onError||console.error;this.use=function(n,r){var i=n,a=r,c=[];if(r||(a=n,i=/^.*$/),!(i instanceof RegExp)){if(i.constructor==Array||i.constructor==Object){for(var s in i)o.use(i[s],r);return o}i=String(i),i=$("<a href='"+i+"'></a>").get(0).pathname,e.strict||(i=i.replace(/\/$/,"")),e.caseSensitive||(i=i.toLowerCase()),e.removeFromPath&&(i=i.replace(e.caseSensitive||"string"!=typeof e.removeFromPath?e.removeFromPath:e.removeFromPath.toLowerCase(),"")),/\:/.test(i)?(i=i.replace(/\*+/g,"").replace(/:([^\/]+)/g,function(e,t){return c.push(t),"([^\\/]+?)"}),i=new RegExp("^"+i.split("([^\\/]+?)").map(function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join("([^\\/]+?)")+"$")):i=new RegExp("^"+i.split(/\*+/).map(function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join(".*")+"$")}return t.push({path:i,keys:c,fn:a}),o},this.on=this.use,this.handle=function(c){var s="string"==typeof c?c:"object"!=typeof c?"/":c.href?c.href:this.href?this.href:this.action?this.action:"/",p=$("<a href="+s+"></a>").get(0),h=p.pathname;e.strict||(h=h.replace(/\/$/,"")),e.caseSensitive||(h=h.toLowerCase()),e.removeFromPath&&(h=h.replace(e.caseSensitive?e.removeFromPath:e.removeFromPath.toLowerCase(),""));var u=[];for(var f in t){var m=t[f];if(m.path.test(h)){var l={},d=h.match(m.path).slice(1);if(m.keys.length)for(var f in d)l[m.keys[f]]=d[f];u.push({fn:m.fn,params:l})}}if(!u.length)return o;c.preventDefault&&c.preventDefault();var v={url:p.href,hostname:p.hostname,pathname:h,protocol:p.protocol?p.protocol.replace(":",""):null,secure:!1,query:i(p.href),params:{},cookies:a(),aviation:o};"https"==v.protocol&&(v.secure=!0);var g={cookie:function(e,t,o){return o||(o={}),v.cookies[e]=t,void 0===o.maxAge&&void 0===o.expires&&(o.maxAge=2628e3),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(o.maxAge?";max-age="+encodeURIComponent(o.maxAge):"")+(o.expires?";expires="+encodeURIComponent(o.expires):"")+(o.path?";path="+encodeURIComponent(o.path):";path")+(o.domain?";domain="+encodeURIComponent(o.domain):"")+(o.secure?";secure="+encodeURIComponent(o.secure):"")+(o.sameSite?";samesite="+encodeURIComponent(o.sameSite):""),this},clearCookie:function(e,t){return t.maxAge=-1,this.cookie(e,null,t),delete v.cookies[e],this},location:function(e){var t=!0;return o.handle({href:e,preventDefault:function(){t=!1}}),t&&(window.location=e),this},redirect:function(e){return this.location(e)},page:function(e,t){return"undefined"!=typeof history&&history.pushState&&history.pushState({},e,t||v.url),$("title").text(e),this},html:function(e){return n.html(e),this}},w=function(e){try{if(e)throw e;var t=u[++f];if(!t)return;v.params=t.params,t.fn(v,g,w)}catch(e){r(e)}};f=-1;return w(),o},$(document).ready(function(){o.handle(window.location)}),$(document).on(e.event||"click",e.source||"a:not([target='_blank'])",o.handle),window.addEventListener("popstate",function(e){o.handle(window.location.href)},!1);var i=function(e){if(!/\?/.test(e))return{};var t={},o=e.split("?")[1].split("&");for(var n in o){var r=o[n].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t},a=function(){var e={},t=document.cookie.split(";");for(var o in t){var n=t[o].split("=");n[0]&&n[1]&&(e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))}return e}}
