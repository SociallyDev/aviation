/* Aviation - URL routing inspired by express for the frontend! | v2.3.1 | Written by Devang Srivastava | MIT License */
if("undefined"==typeof $)throw new Error("Aviation requires jQuery for now.");function Aviation(l){if(!(this instanceof Aviation))return new Aviation(l);"object"!=typeof l&&(l={strict:!1,caseSensitive:!1});var h=[],m=this,d=$(l.contentWrapper||"body"),v=l.onError||function(e){console.error(e)};this.on=function(e,t){var n=e,o=t,r=[];if(t||(o=e,n=/^.*$/),!(n instanceof RegExp)){if(n.constructor==Array||n.constructor==Object){for(var i in n)m.use(n[i],t);return m}n=String(n);var a="";n=$("<a href='"+n+"'></a>").get(0).pathname,l.strict||(n=n.replace(/\/$/,"")),l.caseSensitive||(a="i"),l.removeFromPath&&(n=n.replace(l.removeFromPath,"")),n=/\:/.test(n)?(n=n.replace(/\*+/g,"").replace(/:([^\/]+)/g,function(e,t){return r.push(t),"([^\\/]+?)"}),new RegExp("^"+n.split("([^\\/]+?)").map(function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join("([^\\/]+?)")+"$",a)):new RegExp("^"+n.split(/\*+/).map(function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join(".*")+"$",a)}return h.push({path:n,keys:r,fn:o}),m},this.use=this.on,this.handle=function(e){var t="string"==typeof e?e:"object"!=typeof e?"/":e.href?e.href:this.href?this.href:this.action?this.action:"/",n=$("<a href="+t+"></a>").get(0),o=n.pathname;l.strict||(o=o.replace(/\/$/,"")),l.removeFromPath&&(o=o.replace(l.removeFromPath,""));var r=[];for(var i in h){var a=h[i];if(a.path&&a.path.test(o)){var c={},s=o.match(a.path).slice(1);if(a.keys.length)for(var i in s)c[a.keys[i]]=s[i];r.push({fn:a.fn,params:c})}}if(!r.length)return m;e.preventDefault&&e.preventDefault(),o&&"/"===o[0]||(o="/"+(o||""));var p={url:n.href,hostname:n.hostname,path:o,protocol:n.protocol?n.protocol.replace(":",""):null,secure:!1,query:g(n.href),params:{},cookies:y(),aviation:m};"https"==p.protocol&&(p.secure=!0);var u={cookie:function(e,t,n){return n||(n={}),p.cookies[e]=t,void 0===n.maxAge&&void 0===n.expires&&(n.maxAge=2628e3),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(n.maxAge?";max-age="+encodeURIComponent(n.maxAge):"")+(n.expires?";expires="+encodeURIComponent(n.expires):"")+(n.path?";path="+encodeURIComponent(n.path):";path")+(n.domain?";domain="+encodeURIComponent(n.domain):"")+(n.secure?";secure="+encodeURIComponent(n.secure):"")+(n.sameSite?";samesite="+encodeURIComponent(n.sameSite):""),this},clearCookie:function(e,t){return t.maxAge=-1,this.cookie(e,null,t),delete p.cookies[e],this},location:function(e){var t=!0;return m.handle({href:e,preventDefault:function(){t=!1}}),t&&(window.location=e),this},redirect:function(e){return this.location(e)},page:function(e,t){return"undefined"!=typeof history&&history.pushState&&history.pushState({},e,t||p.url),$("title").text(e),this},html:function(e){return d.html(e),this}},f=function(e){try{if(e)throw e;var t=r[++i];if(!t)return;p.params=t.params;var n=t.fn(p,u,f);n&&n.catch&&n.catch(function(e){v(e,p,u,f)})}catch(e){v(e,p,u,f)}};i=-1;return f(),m},l.cancelLoadRouting||$(document).ready(function(){m.handle(window.location)}),$(document).on(l.event||"click",l.source||"a[href]:not([target='_blank'])",m.handle),window.addEventListener("popstate",function(e){m.handle(window.location.href)},!1);var g=function(e){if(!/\?/.test(e))return{};var t={},n=e.split("?")[1].split("&");for(var o in n){var r=n[o].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t},y=function(){var e={},t=document.cookie.split(";");for(var n in t){var o=t[n].split("=");o[0]&&o[1]&&(e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]))}return e}}Aviation.element=function(){var e=arguments,t="div",n=!1;e[0]&&"string"==typeof e[0]&&(t=e[0],delete e[0]),e[1]&&"object"==typeof e[1]&&(n=e[1],delete e[1]);var o=$("<"+t+">");for(var r in n&&(n.className&&(n.class=n.className,delete n.className),n.style&&n.style.constructor==Object&&(o.css(n.style),delete n.style),o.attr(n)),e)e[r]&&e[r].isAviationElement||(e[r]=Aviation.safe(e[r])),o.append(e[r]);return o.isAviationElement=!0,o},Aviation.safe=function(e){return e?e=String(e).replace(/\&/gi,"&amp;").replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;").replace(/\"/gi,"&quot;").replace(/\'/gi,"&#x27;").replace(/\//gi,"&#x2F;"):""},$.fn.extend({outerHTML:function(){var e="";return this.each(function(){e+=this.outerHTML}),e}});
